{% extends "base.html" %}        

<!-- Section 1 -->


{% block content %}

        <div id="projects" class="dashboard-section">
            <div class="row">
                <div class="col-lg-8">
                    <div class="task-table">
                        <h3 class="p-3">Belle Tasks</h3>
                        <a href="{% url 'belle_task' %}" class="btn btn-sm btn-danger">New Task</a>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th width="80">SN</th>
                                    <th>Task Description</th>
                                    <th>Date Created</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in belle_task %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td class="description-cell">{{ task.description }}</td>
                                    <td class="description-cell">{{ task.date_created|date:"m/d H:i" }}</td>
                                    <td class="description-cell">
                                        <a href="{% url 'update_belle_task' task.id %}" class="btn btn-sm btn-primary">Update</a>
                                        <a href="{% url 'complete_belle_task' task.id %}" class="btn btn-sm btn-success">Complete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">AHS Averages</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="invoiceChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 2 -->
        <div id="development" class="dashboard-section">
            <div class="row">
                <div class="col-lg-8">
                    <div class="task-table">
                        <h3 class="p-3">Bojan Tasks</h3>
                        <a href="{% url 'add_task' %}" class="btn btn-sm btn-danger">New Task</a>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th width="80">SN</th>
                                    <th>Task Description</th>
                                    <th>Date Created</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in all_task %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td class="description-cell">{{ task.description }}</td>
                                    <td class="description-cell">{{ task.date_created|date:"m/d H:i" }}</td>
                                    <td class="description-cell">
                                        <a href="{% url 'update_task' task.id %}" class="btn btn-sm btn-primary">Update</a>
                                        <a href="{% url 'complete_task' task.id %}" class="btn btn-sm btn-success">Complete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">AHS Averages</h5>
                        </div>
                        <div class="card-body">
                            <table class="table table-bordered">
                                <thead class="thead-light">
                                    <tr>
                                        <th>Period</th>
                                        <th>Average Invoiced Amount ($)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Today</td>
                                        <td>${{ current_day_avg|floatformat:2 }}</td>   
                                    </tr>
                                    <tr>
                                        <td>Last 7 Days</td>
                                        <td>${{ seven_day_avg|floatformat:2 }}</td>
                                    </tr>
                                    <tr>
                                        <td>Last 30 Days</td>
                                        <td>${{ thirty_day_avg|floatformat:2 }}</td>  
                                    </tr>
                                    <tr>
                                        <td>Last 6 Months</td>
                                        <td>${{ six_month_avg|floatformat:2 }}</td>
                                    </tr>
                                    <tr>
                                        <td>Last 12 Months</td>
                                        <td>${{ twelve_month_avg|floatformat:2 }}</td>
                                    </tr>
                                </tbody>
                            </table></br>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Section 3 -->
        <div id="marketing" class="dashboard-section">
            <div class="row">
                <div class="col-lg-8">
                    <div class="task-table">
                        <h3 class="p-3">Marvin Tasks</h3>
                        <a href="{% url 'marvin_task' %}" class="btn btn-sm btn-danger">New Task</a>
                        <table class="table">
                            <thead>
                                <tr>
                                    <th width="80">SN</th>
                                    <th>Task Description</th>
                                    <th>Date Created</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for task in marvin_task %}
                                <tr>
                                    <td>{{ forloop.counter }}</td>
                                    <td class="description-cell">{{ task.description }}</td>
                                    <td class="description-cell">{{ task.date_created|date:"m/d H:i" }}</td>
                                    <td class="description-cell">
                                        <a href="{% url 'update_marvin_task' task.id %}" class="btn btn-sm btn-primary">Update</a>
                                        <a href="{% url 'complete_marvin_task' task.id %}" class="btn btn-sm btn-success">Complete</a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
                <!--<div class="col-lg-4">
                    <div class="card">
                        <div class="card-header">
                            <h5 class="card-title mb-0">7880-A Violation</h5>
                        </div>
                        <div class="card-body">
                            <div id="timer" class="display-4 text-center">00:00:00</div>
                            <div class="text-center mt-3">
                                <button id="startBtn" class="btn btn-success">Start</button>
                                <button id="stopBtn" class="btn btn-danger">Stop</button>
                                <button id="resetBtn" class="btn btn-secondary">Reset</button>
                            </div>
                        </div>
                    </div>
                </div>-->
            </div>
        </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
            // Data from Django context
            const currentDayAvg = {{ current_day_avg }};
            const sevenDayAvg = {{ seven_day_avg }};
            const thirtyDayAvg = {{ thirty_day_avg }};
            const sixMonthAvg = {{ six_month_avg }};
            const twelveMonthAvg = {{ twelve_month_avg }};

            // Function to determine bar colors based on new conditions
            function getColor(value) {
                if (value <= 161) {
                    return 'darkgreen'; // Up to 161: DARK GREEN
                } else if (value > 161 && value <= 170) {
                    return 'lightgreen'; // 161-170: LIGHT GREEN
                } else if (value > 170 && value <= 185) {
                    return 'yellow'; // 170-185: YELLOW
                } else if (value > 185 && value <= 200) {
                    return 'orange'; // 185-200: ORANGE
                } else {
                    return 'red'; // 200+: RED
                }
            }

            // Configure chart
            const ctx = document.getElementById('invoiceChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Today', '7 Days', '30 Days', '6 Months', '12 Months'],
                    datasets: [{
                        label: 'Invoice Averages ($)',
                        data: [currentDayAvg, sevenDayAvg, thirtyDayAvg, sixMonthAvg, twelveMonthAvg],
                        backgroundColor: [
                            getColor(currentDayAvg),
                            getColor(sevenDayAvg),
                            getColor(thirtyDayAvg),
                            getColor(sixMonthAvg),
                            getColor(twelveMonthAvg)
                        ],
                        borderColor: ['black', 'black', 'black', 'black', 'black'],
                        borderWidth: 1
                    }]
                },
                options: {
                    plugins: {
                        datalabels: {
                            anchor: "end",  // Position above bars
                            align: "top",  // Align to the top
                            color: "black",  // Label color
                            font: {
                                weight: "bold",
                                size: 14
                            },
                            formatter: function(value) {
                                return `$${value.toFixed(2)}`; // Display as "$xx.xx"
                            }
                        }
                    },
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true
                        }
                    }
                }
            });
</script>

{% endblock %}